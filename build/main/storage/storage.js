"use strict";
var __importDefault = (this && this.__importDefault) || function (mod) {
    return (mod && mod.__esModule) ? mod : { "default": mod };
};
Object.defineProperty(exports, "__esModule", { value: true });
exports.Storage = void 0;
const universal_cookie_1 = __importDefault(require("universal-cookie"));
const constants_1 = require("../constants");
const DEFAULT_COUNTRY = process.env.GXP_DEFAULT_COUNTRY;
const DEFAULT_BRAND = process.env.GXP_DEFAULT_BRAND;
const DEFAULT_LANGUAGE = process.env.GXP_DEFAULT_LANGUAGE;
const defaults = {
    [constants_1.STORAGE_KEYS.COUNTRY]: DEFAULT_COUNTRY,
    [constants_1.STORAGE_KEYS.BRAND]: DEFAULT_BRAND,
    [constants_1.STORAGE_KEYS.LANGUAGE]: DEFAULT_LANGUAGE,
};
const cookiesToKeep = [
    constants_1.STORAGE_KEYS.COUNTRY,
    constants_1.STORAGE_KEYS.BRAND,
    constants_1.STORAGE_KEYS.LANGUAGE,
];
class Storage {
    static initialize(cookies = new universal_cookie_1.default()) {
        this.cookies = cookies;
    }
    static getData(key) {
        var _a;
        if (!this.cookies)
            this.initialize();
        const value = this.cookies.get(key) || "";
        if (value === "" && defaults[key]) {
            return (_a = defaults[key]) !== null && _a !== void 0 ? _a : "";
        }
        return value;
    }
    static setData(key, value) {
        if (!this.cookies)
            this.initialize();
        const jsonValue = typeof value === "string" ? value : JSON.stringify(value);
        this.cookies.set(key, jsonValue);
    }
    static removeData(key) {
        if (!this.cookies)
            this.initialize();
        this.cookies.remove(key);
    }
    static removeAll() {
        if (!this.cookies)
            this.initialize();
        Object.keys(this.cookies.getAll()).forEach((key) => {
            if (!cookiesToKeep.includes(key)) {
                this.removeData(key);
            }
        });
    }
    static addListener(callback) {
        if (!this.cookies)
            this.initialize();
        this.cookies.addChangeListener(callback);
    }
}
exports.Storage = Storage;
//# sourceMappingURL=data:application/json;base64,eyJ2ZXJzaW9uIjozLCJmaWxlIjoic3RvcmFnZS5qcyIsInNvdXJjZVJvb3QiOiIiLCJzb3VyY2VzIjpbIi4uLy4uLy4uL3NyYy9zdG9yYWdlL3N0b3JhZ2UudHMiXSwibmFtZXMiOltdLCJtYXBwaW5ncyI6Ijs7Ozs7O0FBQUEsd0VBQWlFO0FBRWpFLDRDQUE0QztBQUU1QyxNQUFNLGVBQWUsR0FBRyxPQUFPLENBQUMsR0FBRyxDQUFDLG1CQUFtQixDQUFDO0FBQ3hELE1BQU0sYUFBYSxHQUFHLE9BQU8sQ0FBQyxHQUFHLENBQUMsaUJBQWlCLENBQUM7QUFDcEQsTUFBTSxnQkFBZ0IsR0FBRyxPQUFPLENBQUMsR0FBRyxDQUFDLG9CQUFvQixDQUFDO0FBRTFELE1BQU0sUUFBUSxHQUFHO0lBQ2YsQ0FBQyx3QkFBWSxDQUFDLE9BQU8sQ0FBQyxFQUFFLGVBQWU7SUFDdkMsQ0FBQyx3QkFBWSxDQUFDLEtBQUssQ0FBQyxFQUFFLGFBQWE7SUFDbkMsQ0FBQyx3QkFBWSxDQUFDLFFBQVEsQ0FBQyxFQUFFLGdCQUFnQjtDQUMxQyxDQUFDO0FBRUYsTUFBTSxhQUFhLEdBQUc7SUFDcEIsd0JBQVksQ0FBQyxPQUFPO0lBQ3BCLHdCQUFZLENBQUMsS0FBSztJQUNsQix3QkFBWSxDQUFDLFFBQVE7Q0FDdEIsQ0FBQztBQUVGLE1BQWEsT0FBTztJQUdYLE1BQU0sQ0FBQyxVQUFVLENBQUMsVUFBbUIsSUFBSSwwQkFBTyxFQUFFO1FBQ3ZELElBQUksQ0FBQyxPQUFPLEdBQUcsT0FBTyxDQUFDO0lBQ3pCLENBQUM7SUFFTSxNQUFNLENBQUMsT0FBTyxDQUFDLEdBQVc7O1FBQy9CLElBQUksQ0FBQyxJQUFJLENBQUMsT0FBTztZQUFFLElBQUksQ0FBQyxVQUFVLEVBQUUsQ0FBQztRQUNyQyxNQUFNLEtBQUssR0FBRyxJQUFJLENBQUMsT0FBTyxDQUFDLEdBQUcsQ0FBQyxHQUFHLENBQUMsSUFBSSxFQUFFLENBQUM7UUFDMUMsSUFBSSxLQUFLLEtBQUssRUFBRSxJQUFJLFFBQVEsQ0FBQyxHQUFHLENBQUMsRUFBRTtZQUNqQyxPQUFPLE1BQUEsUUFBUSxDQUFDLEdBQUcsQ0FBQyxtQ0FBSSxFQUFFLENBQUM7U0FDNUI7UUFDRCxPQUFPLEtBQUssQ0FBQztJQUNmLENBQUM7SUFFTSxNQUFNLENBQUMsT0FBTyxDQUFDLEdBQVcsRUFBRSxLQUFjO1FBQy9DLElBQUksQ0FBQyxJQUFJLENBQUMsT0FBTztZQUFFLElBQUksQ0FBQyxVQUFVLEVBQUUsQ0FBQztRQUNyQyxNQUFNLFNBQVMsR0FBRyxPQUFPLEtBQUssS0FBSyxRQUFRLENBQUMsQ0FBQyxDQUFDLEtBQUssQ0FBQyxDQUFDLENBQUMsSUFBSSxDQUFDLFNBQVMsQ0FBQyxLQUFLLENBQUMsQ0FBQztRQUM1RSxJQUFJLENBQUMsT0FBTyxDQUFDLEdBQUcsQ0FBQyxHQUFHLEVBQUUsU0FBUyxDQUFDLENBQUM7SUFDbkMsQ0FBQztJQUVNLE1BQU0sQ0FBQyxVQUFVLENBQUMsR0FBVztRQUNsQyxJQUFJLENBQUMsSUFBSSxDQUFDLE9BQU87WUFBRSxJQUFJLENBQUMsVUFBVSxFQUFFLENBQUM7UUFDckMsSUFBSSxDQUFDLE9BQU8sQ0FBQyxNQUFNLENBQUMsR0FBRyxDQUFDLENBQUM7SUFDM0IsQ0FBQztJQUVNLE1BQU0sQ0FBQyxTQUFTO1FBQ3JCLElBQUksQ0FBQyxJQUFJLENBQUMsT0FBTztZQUFFLElBQUksQ0FBQyxVQUFVLEVBQUUsQ0FBQztRQUNyQyxNQUFNLENBQUMsSUFBSSxDQUFDLElBQUksQ0FBQyxPQUFPLENBQUMsTUFBTSxFQUFFLENBQUMsQ0FBQyxPQUFPLENBQUMsQ0FBQyxHQUFHLEVBQUUsRUFBRTtZQUNqRCxJQUFJLENBQUMsYUFBYSxDQUFDLFFBQVEsQ0FBQyxHQUFHLENBQUMsRUFBRTtnQkFDaEMsSUFBSSxDQUFDLFVBQVUsQ0FBQyxHQUFHLENBQUMsQ0FBQzthQUN0QjtRQUNILENBQUMsQ0FBQyxDQUFDO0lBQ0wsQ0FBQztJQUVNLE1BQU0sQ0FBQyxXQUFXLENBQUMsUUFBOEI7UUFDdEQsSUFBSSxDQUFDLElBQUksQ0FBQyxPQUFPO1lBQUUsSUFBSSxDQUFDLFVBQVUsRUFBRSxDQUFDO1FBQ3JDLElBQUksQ0FBQyxPQUFPLENBQUMsaUJBQWlCLENBQUMsUUFBUSxDQUFDLENBQUM7SUFDM0MsQ0FBQztDQUNGO0FBeENELDBCQXdDQyJ9